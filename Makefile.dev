.PHONY: help-dev start-dev stop-dev restart-dev status-dev logs-dev logs-server-dev logs-backend-dev logs-frontend-dev build-dev clean-dev shell-server-dev shell-backend-dev info-dev health-dev

# Variables
COMPOSE := docker compose -f docker-compose.dev.yml
DATA_DIR := ./data-dev
BACKUP_DIR := ./backups-dev

# Couleurs
RED := \033[0;31m
GREEN := \033[0;32m
YELLOW := \033[1;33m
BLUE := \033[0;34m
NC := \033[0m # No Color

help-dev: ## Afficher l'aide pour l'environnement DEV
	@echo "$(BLUE)Hytale Web Manager - Commandes DEV$(NC)"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | grep 'dev' | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  $(GREEN)%-20s$(NC) %s\n", $$1, $$2}'
	@echo ""

start-dev: ## Démarrer tous les services DEV
	@echo "$(GREEN)Démarrage des services DEV...$(NC)"
	@$(COMPOSE) up -d
	@echo "$(GREEN)✓ Services DEV démarrés$(NC)"
	@$(MAKE) status-dev

stop-dev: ## Arrêter tous les services DEV
	@echo "$(YELLOW)Arrêt des services DEV...$(NC)"
	@$(COMPOSE) down
	@echo "$(YELLOW)✓ Services DEV arrêtés$(NC)"

restart-dev: ## Redémarrer tous les services DEV
	@echo "$(BLUE)Redémarrage des services DEV...$(NC)"
	@$(COMPOSE) restart
	@echo "$(GREEN)✓ Services DEV redémarrés$(NC)"

status-dev: ## Afficher le statut des services DEV
	@echo "$(BLUE)Statut des services DEV:$(NC)"
	@$(COMPOSE) ps

logs-dev: ## Voir tous les logs DEV
	@$(COMPOSE) logs -f

logs-server-dev: ## Voir les logs du serveur Hytale DEV
	@$(COMPOSE) logs -f hytale-server-dev

logs-backend-dev: ## Voir les logs du backend DEV
	@$(COMPOSE) logs -f backend-dev

logs-frontend-dev: ## Voir les logs du frontend DEV
	@$(COMPOSE) logs -f frontend-dev

build-dev: ## Reconstruire les images Docker DEV
	@echo "$(BLUE)Reconstruction des images DEV...$(NC)"
	@$(COMPOSE) build --no-cache
	@echo "$(GREEN)✓ Images DEV reconstruites$(NC)"

clean-dev: ## Nettoyer les containers et images DEV
	@echo "$(YELLOW)Nettoyage DEV...$(NC)"
	@$(COMPOSE) down -v
	@echo "$(GREEN)✓ Nettoyage DEV terminé$(NC)"

shell-server-dev: ## Accéder au shell du conteneur serveur DEV
	@$(COMPOSE) exec hytale-server-dev sh

shell-backend-dev: ## Accéder au shell du conteneur backend DEV
	@$(COMPOSE) exec backend-dev sh

health-dev: ## Vérifier la santé de l'application DEV
	@echo "$(BLUE)Vérification de la santé DEV...$(NC)"
	@echo ""
	@echo "$(BLUE)Backend API DEV:$(NC)"
	@curl -s http://localhost:4001/api/health | python3 -m json.tool || echo "$(RED)✗ Backend DEV inaccessible$(NC)"
	@echo ""
	@echo "$(BLUE)Frontend DEV:$(NC)"
	@curl -s -o /dev/null -w "%{http_code}" http://localhost:3001 | grep -q 200 && echo "$(GREEN)✓ Frontend DEV accessible$(NC)" || echo "$(RED)✗ Frontend DEV inaccessible$(NC)"
	@echo ""
	@echo "$(BLUE)Serveur Hytale DEV:$(NC)"
	@$(COMPOSE) exec hytale-server-dev sh -c "/control-server.sh status" || echo "$(RED)✗ Serveur DEV inaccessible$(NC)"

info-dev: ## Afficher les informations du projet DEV
	@echo "$(BLUE)═══════════════════════════════════════$(NC)"
	@echo "$(GREEN)  Hytale Web Manager - DEV$(NC)"
	@echo "$(BLUE)═══════════════════════════════════════$(NC)"
	@echo ""
	@echo "$(BLUE)URLs DEV:$(NC)"
	@echo "  Frontend:  $(GREEN)http://localhost:3001$(NC)"
	@echo "  Backend:   $(GREEN)http://localhost:4001$(NC)"
	@echo "  Server:    $(GREEN)localhost:5521$(NC) (UDP)"
	@echo ""
	@echo "$(BLUE)Données DEV:$(NC)"
	@echo "  Data:      $(DATA_DIR)"
	@echo "  Backups:   $(BACKUP_DIR)"
	@echo ""
	@echo "$(BLUE)Commandes utiles DEV:$(NC)"
	@echo "  make start-dev      - Démarrer"
	@echo "  make logs-dev       - Voir les logs"
	@echo "  make health-dev     - Vérifier la santé"
	@echo "  make help-dev       - Voir toutes les commandes"
	@echo ""
